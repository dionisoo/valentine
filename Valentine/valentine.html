<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Be My Valentine?</title>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
  :root{
    --bg:#ffd6e7;
    --pink:#ff4d88;
    --text:#7a1f3d;
    --shadow:0 18px 50px rgba(0,0,0,0.18);
  }
  *{ box-sizing:border-box; }

  body{
    margin:0;
    height:100vh;
    display:grid;
    place-items:center;
    background: radial-gradient(circle at top, #ffe3ef, var(--bg));
    font-family: Arial, sans-serif;
    overflow:hidden;
    color:var(--text);
  }

  /* ---------- Envelope ---------- */
  .envelope-scene{
    width:min(560px, 94vw);
    height: min(420px, 70vh);
    position:relative;
    display:grid;
    place-items:center;
  }
  .envelope-scene.closed{
    animation: floaty 2.6s ease-in-out infinite;
  }
  @keyframes floaty{
    0%,100%{ transform: translateY(0); }
    50%{ transform: translateY(-6px); }
  }

  .envelope{
    width:min(520px, 92vw);
    height: 330px;
    position:relative;
    filter: drop-shadow(var(--shadow));
  }

  .env-base{
    position:absolute;
    inset:0;
    background: linear-gradient(145deg, #fff, #fff6fa);
    border-radius: 22px;
    border:2px solid rgba(255,77,136,0.18);
    overflow:hidden;
  }

  .env-bottom-left,
  .env-bottom-right{
    position:absolute;
    bottom:-2px;
    width:60%;
    height:62%;
    background: linear-gradient(145deg, rgba(255,77,136,0.10), rgba(255,255,255,0));
    border:2px solid rgba(255,77,136,0.14);
  }

  .env-bottom-left{
    left:-10%;
    transform: skewX(30deg);
    border-right:none;
    border-top:none;
  }
  .env-bottom-right{
    right:-10%;
    transform: skewX(-30deg);
    border-left:none;
    border-top:none;
  }

  .env-seam{
    position:absolute;
    left:50%;
    top:48%;
    width:2px;
    height:60%;
    transform:translateX(-50%);
    background: rgba(255,77,136,0.14);
  }

  .env-flap{
    position:absolute;
    left:0;
    right:0;
    top:0;
    height:58%;
    transform-origin: top center;
    transform: rotateX(0deg);
    transition: transform 900ms cubic-bezier(.2,.8,.2,1);
    z-index: 5;
    pointer-events:none;
  }
  .env-flap::before{
    content:"";
    position:absolute;
    inset:0;
    background: linear-gradient(145deg, rgba(255,77,136,0.18), rgba(255,255,255,0.65));
    clip-path: polygon(0 0, 100% 0, 50% 100%);
    border-bottom:2px solid rgba(255,77,136,0.18);
  }

  /* Heart seal (click to open) */
  .seal{
    position:absolute;
    left:50%;
    top:52%;
    transform: translate(-50%,-50%);
    width:54px;
    height:54px;
    border-radius: 16px;
    background: linear-gradient(145deg, var(--pink), #ff2d70);
    box-shadow: 0 10px 20px rgba(0,0,0,0.18);
    z-index: 6;
    display:grid;
    place-items:center;
    color:white;
    font-size:22px;
    transition: transform 450ms ease, opacity 250ms ease;
    cursor:pointer;
    user-select:none;
  }

  /* Letter */
  .letter{
    position:absolute;
    left:50%;
    bottom:18px;
    transform: translateX(-50%) translateY(55px);
    width: calc(100% - 42px);
    max-width: 500px;
    background:#ffffff;
    border:2px solid rgba(255,77,136,0.22);
    border-radius: 22px;
    box-shadow: 0 18px 55px rgba(0,0,0,0.20);
    padding: 22px 20px 18px;
    text-align:center;
    opacity: 0;
    transition: transform 900ms cubic-bezier(.2,.8,.2,1), opacity 450ms ease;
    z-index: 20;
  }

  .envelope-scene.open .env-flap{ transform: rotateX(165deg); }
  .envelope-scene.open .seal{ opacity:0; transform: translate(-50%,-50%) scale(0.75); pointer-events:none; }
  .envelope-scene.open .letter{ transform: translateX(-50%) translateY(-10px); opacity:1; }

  .hint{
    position:absolute;
    bottom: -34px;
    width:100%;
    text-align:center;
    font-size: 13px;
    opacity: 0.85;
    user-select:none;
  }

  /* Inside content */
  h1{
    margin: 4px 0 14px;
    color:#c2185b;
    font-size: clamp(26px, 4vw, 38px);
    line-height:1.1;
  }

  .media{
    display:none;
    margin: 0 auto 14px;
    width: min(340px, 84vw);
    border-radius: 16px;
    overflow:hidden;
    box-shadow: 0 12px 30px rgba(0,0,0,0.18);
    border:2px solid rgba(255,77,136,0.22);
    background:white;
  }
  .media img{ width:100%; display:block; }

  .btnRow{
    display:flex;
    justify-content:center;
    gap:14px;
    flex-wrap:wrap;
    margin-top: 4px;
    position: relative;
    z-index: 30;
  }

  button{
    border:none;
    border-radius:12px;
    padding:12px 22px;
    font-size:18px;
    font-weight:700;
    cursor:pointer;
    box-shadow: 0 10px 22px rgba(0,0,0,0.12);
    user-select:none;
    touch-action:manipulation;
    white-space:nowrap;
  }

  #yesBtn{ background:#28a745; color:white; transform-origin:center; }
  #noBtn{ background:#ff4d6d; color:white; position:relative; }

  /* Runaway mode: fixed and ALWAYS constrained to a centered zone via transform offsets */
  #noBtn.runaway{
    position:fixed;
    z-index:9999;
    left:50%;
    top:50%;
    transform: translate(-50%, -50%);
  }
</style>
</head>

<body>

<div class="envelope-scene closed" id="scene">
  <div class="envelope">
    <div class="env-base">
      <div class="env-bottom-left"></div>
      <div class="env-bottom-right"></div>
      <div class="env-seam"></div>
    </div>

    <div class="env-flap"></div>
    <div class="seal" id="seal">‚ù§</div>

    <div class="letter">
      <div id="mediaWrap" class="media">
        <img id="mediaImg" src="" alt="media">
      </div>

      <h1 id="question">Will you be my Valentine? üíò</h1>

      <div class="btnRow" id="btnRow">
        <button id="yesBtn">Yes</button>
        <button id="noBtn">No</button>
      </div>
    </div>
  </div>

  <div class="hint" id="hint">Tap the heart to open üíå</div>
</div>

<!-- Put these files in the SAME folder as this HTML:
     bruh.mp3, careless.mp3, IMG_0531.jpg, cute.gif -->
<audio id="bruhSound" src="bruh.mp3" preload="auto"></audio>
<audio id="loveMusic" src="careless.mp3" preload="auto"></audio>

<script>
  // Envelope open
  const scene = document.getElementById("scene");
  const hint = document.getElementById("hint");
  const seal = document.getElementById("seal");

  let openedOnce = false;
  function openEnvelope(){
    if (openedOnce) return;
    openedOnce = true;
    scene.classList.add("open");
    scene.classList.remove("closed");
    hint.style.display = "none";
  }
  seal.addEventListener("click", (e) => { e.stopPropagation(); openEnvelope(); });

  // Valentine logic
  const noBtn = document.getElementById("noBtn");
  const yesBtn = document.getElementById("yesBtn");
  const question = document.getElementById("question");
  const mediaWrap = document.getElementById("mediaWrap");
  const mediaImg = document.getElementById("mediaImg");
  const bruhSound = document.getElementById("bruhSound");
  const loveMusic = document.getElementById("loveMusic");

  let runawayEnabled = false;

  const baseYes = {
    fontSize: parseFloat(getComputedStyle(yesBtn).fontSize),
    padY: 12,
    padX: 22
  };
  let growCount = 0;

  // Bruh throttle
  let lastBruhAt = 0;
  function playBruh(){
    const now = Date.now();
    if (now - lastBruhAt < 180) return;
    lastBruhAt = now;
    bruhSound.currentTime = 0;
    bruhSound.play().catch(()=>{});
  }

  function growYes(){
    growCount += 1;
    const factor = 1 + growCount * 0.18;
    yesBtn.style.fontSize = (baseYes.fontSize * factor) + "px";
    yesBtn.style.padding = (baseYes.padY * factor) + "px " + (baseYes.padX * factor) + "px";
  }

  // ---- Center-zone runaway positioning (never leaves view) ----
  function enableRunaway(){
    if (runawayEnabled) return;
    runawayEnabled = true;
    noBtn.classList.add("runaway");
    setNoOffset(0, 0);
  }

  function setNoOffset(dx, dy){
    noBtn.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
  }

  function moveNoButtonCenter(){
    const vw = document.documentElement.clientWidth;
    const vh = document.documentElement.clientHeight;

    // Center zone (tweak if you want tighter/looser)
    const zoneW = Math.min(520, Math.max(260, vw * 0.55));
    const zoneH = Math.min(320, Math.max(200, vh * 0.35));

    // Measure button AFTER it's runaway
    const r = noBtn.getBoundingClientRect();

    const maxDx = Math.max(0, zoneW/2 - r.width/2 - 12);
    const maxDy = Math.max(0, zoneH/2 - r.height/2 - 12);

    const dx = (Math.random() * 2 - 1) * maxDx;
    const dy = (Math.random() * 2 - 1) * maxDy;

    setNoOffset(dx, dy);
  }

  function escapeAndGrow(){
    enableRunaway();
    moveNoButtonCenter();
    growYes();
  }

  function isNearNo(x, y){
    if (!runawayEnabled) return false;
    const r = noBtn.getBoundingClientRect();
    const cx = r.left + r.width/2;
    const cy = r.top  + r.height/2;
    return Math.hypot(x - cx, y - cy) < 120;
  }

  // Bruh on hover
  noBtn.addEventListener("mouseenter", playBruh);

  // NO click
  noBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    openEnvelope();

    playBruh();
    mediaImg.src = "IMG_0531.jpg";
    mediaWrap.style.display = "block";
    question.textContent = "Are you sure? ü•∫";

    escapeAndGrow();
  });

  // Mouse close: escape+grow in center zone
  document.addEventListener("mousemove", (e) => {
    if (!runawayEnabled) return;
    if (isNearNo(e.clientX, e.clientY)) {
      playBruh();
      escapeAndGrow();
    }
  });

  // Touch move: same
  document.addEventListener("touchmove", (e) => {
    if (!runawayEnabled) return;
    const t = e.touches[0];
    if (!t) return;
    if (isNearNo(t.clientX, t.clientY)) {
      playBruh();
      escapeAndGrow();
    }
  }, { passive:true });

  // YES click: play music ONLY here
  yesBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    openEnvelope();

    // Play romantic/funny music
    loveMusic.currentTime = 0;
    loveMusic.play().catch(()=>{});

    // Replace media with gif
    mediaImg.src = "cute.gif";
    mediaWrap.style.display = "block";

    question.textContent = "I love you Chicky!!! B+J Adventures Forever ‚ù§Ô∏è";
    document.getElementById("btnRow").style.display = "none";

    confetti({ particleCount: 220, spread: 90, origin: { y: 0.6 } });
    setTimeout(() => confetti({ particleCount: 140, spread: 120, origin: { y: 0.55 } }), 250);
    setTimeout(() => confetti({ particleCount: 120, spread: 80, origin: { y: 0.70 } }), 500);
  });

  window.addEventListener("resize", () => {
    if (runawayEnabled) moveNoButtonCenter();
  });
</script>

</body>
</html>
